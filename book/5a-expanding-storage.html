<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Expanding Storage - Linux Systems Administration</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="Entry level book on Linux systems administration.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="p1-linux-sysadmin.html"><strong aria-hidden="true">1.</strong> Linux Systems Administration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="1a-history-linux-unix.html"><strong aria-hidden="true">1.1.</strong> History of Unix and Linux</a></li><li class="chapter-item expanded "><a href="1b-what-is-linux.html"><strong aria-hidden="true">1.2.</strong> What is Linux?</a></li><li class="chapter-item expanded "><a href="1c-what-is-sysadmin.html"><strong aria-hidden="true">1.3.</strong> What is Systems Administration?</a></li></ol></li><li class="chapter-item expanded "><a href="p2-project-management.html"><strong aria-hidden="true">2.</strong> Project Management</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="2a-using-gcloud-virtual-machines.html"><strong aria-hidden="true">2.1.</strong> Using gcloud for Virtual Machines</a></li><li class="chapter-item expanded "><a href="2b-using-git-github-for-documentation.html"><strong aria-hidden="true">2.2.</strong> Using Git and GitHub for Documentation</a></li></ol></li><li class="chapter-item expanded "><a href="p3-the-command-line.html"><strong aria-hidden="true">3.</strong> Learning the Command Line</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="3a-the-linux-filesystem.html"><strong aria-hidden="true">3.1.</strong> The Linux Filesystem</a></li><li class="chapter-item expanded "><a href="3b-files-and-directories.html"><strong aria-hidden="true">3.2.</strong> Files and Directories</a></li><li class="chapter-item expanded "><a href="3c-file-perms-owns.html"><strong aria-hidden="true">3.3.</strong> File Permissions and Ownership</a></li><li class="chapter-item expanded "><a href="3d-text-processing-part-1.html"><strong aria-hidden="true">3.4.</strong> Text Processing: Part 1</a></li><li class="chapter-item expanded "><a href="3e-text-processing-part-2.html"><strong aria-hidden="true">3.5.</strong> Text Processing: Part 2</a></li><li class="chapter-item expanded "><a href="3f-review.html"><strong aria-hidden="true">3.6.</strong> Review</a></li></ol></li><li class="chapter-item expanded "><a href="p4-scripting-the-command-line.html"><strong aria-hidden="true">4.</strong> Scripting the Command Line</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="4a-text-editors.html"><strong aria-hidden="true">4.1.</strong> Text Editors</a></li><li class="chapter-item expanded "><a href="4b-regular-expressions.html"><strong aria-hidden="true">4.2.</strong> Regular Expressions</a></li><li class="chapter-item expanded "><a href="4c-bash-scripting.html"><strong aria-hidden="true">4.3.</strong> Bash Scripting</a></li></ol></li><li class="chapter-item expanded "><a href="p5-managing-the-system.html"><strong aria-hidden="true">5.</strong> Managing the System</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="5a-expanding-storage.html" class="active"><strong aria-hidden="true">5.1.</strong> Expanding Storage</a></li><li class="chapter-item expanded "><a href="5b-managing-users-groups.html"><strong aria-hidden="true">5.2.</strong> Managing Users and Groups</a></li><li class="chapter-item expanded "><a href="5c-managing-software.html"><strong aria-hidden="true">5.3.</strong> Managing Software</a></li><li class="chapter-item expanded "><a href="5d-using-systemd.html"><strong aria-hidden="true">5.4.</strong> Using systemd</a></li></ol></li><li class="chapter-item expanded "><a href="p6-networking-security.html"><strong aria-hidden="true">6.</strong> Networking and Security</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="6a-networking-tcpip.html"><strong aria-hidden="true">6.1.</strong> Networking and TCP/IP</a></li><li class="chapter-item expanded "><a href="6b-dns-domain-names.html"><strong aria-hidden="true">6.2.</strong> DNS and Domain Names</a></li><li class="chapter-item expanded "><a href="6c-local-security.html"><strong aria-hidden="true">6.3.</strong> Local Security</a></li><li class="chapter-item expanded "><a href="6d-firewall-backups.html"><strong aria-hidden="true">6.4.</strong> Firewalls and Backups</a></li></ol></li><li class="chapter-item expanded "><a href="p7-creating-a-lamp-server.html"><strong aria-hidden="true">7.</strong> Creating a LAMP Server</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="7a-installing-the-apache-web-server.html"><strong aria-hidden="true">7.1.</strong> Installing the Apache Web Server</a></li><li class="chapter-item expanded "><a href="7b-installing-configuring-php.html"><strong aria-hidden="true">7.2.</strong> Installing and Configuring PHP</a></li><li class="chapter-item expanded "><a href="7c-installing-configuring-mariadb.html"><strong aria-hidden="true">7.3.</strong> Installing and Configuring MariaDB</a></li><li class="chapter-item expanded "><a href="7d-install-wordpress.html"><strong aria-hidden="true">7.4.</strong> Installing WordPress</a></li><li class="chapter-item expanded "><a href="7e-gcloud-CLI-assignment.html"><strong aria-hidden="true">7.5.</strong> Google Cloud CLI Assignment</a></li></ol></li><li class="chapter-item expanded "><a href="p8-conclusion.html"><strong aria-hidden="true">8.</strong> Conclusion</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Linux Systems Administration</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/cseanburns/linux_sysadmin" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="expanding-storage"><a class="header" href="#expanding-storage">Expanding Storage</a></h1>
<p>I'm sure all or most of you have needed
extra disk storage at some point
(USB drives, optical disks, floppies???).
Such needs are no different for systems administrators,
who often are responsible for managing, monitoring,
or storing large amounts of data.</p>
<p>The disk that we created for our VM is small (10 GB),
and that's fine for our needs,
albeit quite small in many real world scenarios.
To address this,
we can add a persistent disk
that is much larger.
In this section,
we will add a disk to our VM,
mount it onto the VM's filesystem, and format it.
Extra storage does incur extra cost.
So at the end of this section,
I will show you how to delete the extra
disk to avoid that if you want.</p>
<p>We will essentially follow the Google Cloud tutorial
to add a non-boot disk to our VM, but
with some modification.</p>
<p><a href="https://cloud.google.com/compute/docs/disks/add-persistent-disk">Add a persistent disk to your VM</a></p>
<blockquote>
<p>Note: the main disk used by our VM is the <strong>boot disk</strong>.
The boot disk contains the
software required to boot the system.
All of our computers
(desktops, laptops, tablets, phones, etc.),
regardless of which operating system they run,
have some kind of boot system.</p>
</blockquote>
<h2 id="creating-a-disk"><a class="header" href="#creating-a-disk">Creating a Disk</a></h2>
<p>In the Google Cloud console,
visit the <strong>Disks</strong> page in the <strong>Storage</strong> section,
which should be here:</p>
<p><a href="https://console.cloud.google.com/compute/disksAdd">Create a disk</a></p>
<p>And then follow these steps:</p>
<ol>
<li>Under <strong>Name</strong>, add a preferred name or leave the default.</li>
<li>Under <strong>Description</strong>, add text to describe your disk.</li>
<li>Under <strong>Location</strong>, leave or choose <strong>Single zone</strong>.
<ul>
<li>We are not concerned about data safety.</li>
<li>If we were, then we would select other options here.</li>
</ul>
</li>
<li>Under <strong>Source</strong>, select <strong>Blank disk</strong>.</li>
<li>Under <strong>Disk settings</strong>, select <strong>Balanced persistent disk</strong>.</li>
<li>Under <strong>Size</strong>, change this to 10GB.
<ul>
<li>You can actually choose larger sizes, but be aware that <a href="https://cloud.google.com/compute/all-pricing#disk">disk
pricing</a> is $0.10 per GB.</li>
<li>At that cost, 100 GB = $10 / month.</li>
</ul>
</li>
<li>Click on <strong>Enable snapshot schedule</strong>.</li>
<li>Under <strong>Encryption</strong>, make sure <strong>Google-managed encryption key</strong> is
selected.</li>
<li>Click <strong>Create</strong> to create your disk.</li>
</ol>
<h2 id="adding-the-disk-to-our-vm"><a class="header" href="#adding-the-disk-to-our-vm">Adding the Disk to our VM</a></h2>
<p>Now that we have created our disk,
we need to <strong>mount</strong> it onto our filesystem
so that it's available to our VM.
Conceptually, this process is like inserting
a new USB drive into our computer.</p>
<p>To add the new disk to our VM,
follow these steps:</p>
<ol>
<li>Visit the <strong>VM instances</strong> page.</li>
<li>Click on the check box next to your virtual machine.
<ul>
<li>That will convert the <strong>Name</strong> of your VM into a hyperlink.</li>
</ul>
</li>
<li>Click on that <strong>Name</strong>.
<ul>
<li>That will take you to the <strong>VM instance details</strong> page.</li>
</ul>
</li>
<li>Click on the <strong>Edit</strong> button at the top of the details page.</li>
<li>Under the <strong>Additional disks</strong> section, click on <strong>+ ATTACH EXISTING DISK</strong>.</li>
<li>A panel will open on the right side of your browser.</li>
<li>Click on the drop down box and select the disk, by name, you created.</li>
<li>Leave the defaults as-is.</li>
<li>Click on the <strong>SAVE</strong> button.</li>
<li>Then click on the <strong>SAVE</strong> button on the details page.</li>
</ol>
<p>If you return to the <strong>Disks</strong> page in the <strong>Storage</strong> section,
you will now see that the new disk is in use by our VM.</p>
<h2 id="formatting-and-mounting-a-non-boot-disk"><a class="header" href="#formatting-and-mounting-a-non-boot-disk">Formatting and Mounting a Non-Boot Disk</a></h2>
<h3 id="formatting-our-disk"><a class="header" href="#formatting-our-disk">Formatting Our Disk</a></h3>
<p>In order for our VM to make use of the extra storage,
the new drive must be formatted and mounted.
Different operating systems use different filesystem formats.
You may already know that
macOS uses the <a href="https://support.apple.com/guide/disk-utility/file-system-formats-dsku19ed921c/mac">Apple File System (APFS)</a> by default
and that Windows uses the
<a href="https://docs.microsoft.com/en-us/windows-server/storage/file-server/ntfs-overview">New Technology File System (NTFS)</a>.
Linux is no different, but
uses different file systems than macOS and Windows, by default.
There are many formatting technologies that we can use in Linux,
but we'll use the <a href="https://ext4.wiki.kernel.org/index.php/Main_Page">ext4 (fourth extended filesystem)</a> format,
since this is recommended by Google Cloud and
is also a stable and common one for Linux.</p>
<p>In this section, we will closely follow the steps
outlined under the
<a href="https://cloud.google.com/compute/docs/disks/add-persistent-disk"><strong>Formatting and mounting a non-boot disk on a Linux VM</strong></a>
section.
I replicate those instructions below, but
I highly encourage you to read through
the instructions on Google Cloud and here:</p>
<ol>
<li>Use the <code>gcloud compute ssh</code> command that you
have previously used to connect to your VM.
<ul>
<li>Alternatively, you can <code>ssh</code> to your VM via your browser:
<ul>
<li>Click on the <strong>VM instances</strong> page.</li>
<li>Under the <strong>Connect</strong> column,
select <strong>Open in browser window</strong> next to <strong>SSH</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>When you have connected to your VM's command line, run the <code>lsblk</code>
command.
<ul>
<li>Ignore the <strong>loop</strong> devices.</li>
<li>Instead, you should see <strong>sda</strong> and <strong>sdb</strong> under the <strong>NAME</strong> column
outputted by the <code>lsblk</code> command.</li>
<li><strong>sda</strong> represents your main disk.
<ul>
<li><strong>sda1, sda14, sda15</strong> (may be slightly different for you)
represent the partitions of the <strong>sda</strong> disk.</li>
<li>Notice the <strong>MOUNTPOINT</strong> for <strong>sda1</strong> is <code>/</code>,
or the root level of our filesystem.</li>
</ul>
</li>
<li><strong>sdb</strong> represents the attached disk we just added.
<ul>
<li>After we format this drive, there will be an <strong>sdb1</strong>, and this
partition will also have a mountpoint.</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>To format our disk for the <strong>ext4</strong> filesystem,
we will use the <code>mkfs.ext4</code>
(see <code>man mkfs.ext4</code> for details).
The instructions tell us to run the following command
(please read the Google Cloud instructions closely;
<strong>it's important to understand these commands as much
as possible and not just copy and paste them</strong>):</p>
<pre><code>sudo mkfs.ext4 -m 0 -E lazy_itable_init=0,lazy_journal_init=0,discard /dev/DEVICE_NAME
</code></pre>
<p>But replace <strong>DEVICE_NAME</strong> with the name of our device.
My device's name is <strong>sdb</strong>,
which we saw with the output of the <code>lsblk</code> command;
therefore, the specific command I run is:</p>
<pre><code>sudo mkfs.ext4 -m 0 -E lazy_itable_init=0,lazy_journal_init=0,discard /dev/sdb
</code></pre>
<h3 id="mounting-our-disk"><a class="header" href="#mounting-our-disk">Mounting Our Disk</a></h3>
<p>Now that our disk has been formatted in <strong>ext4</strong>,
I can mount it.</p>
<blockquote>
<p>Note: to <strong>mount</strong> a disk simply means to make the disk's
filesystem available so that we can use it for accessing,
storing, etc files on the disk.
Whenever we insert a USB drive, a DVD drive, etc
into our computers,
the OS you use should mount that disk automatically
so that you can access and use that disk.
Conversely, when we remove those drives,
the OS <strong>unmounts</strong> them.
In Linux, the commands for these are <code>mount</code> and <code>umount</code>.
Note that the <code>umount</code> command is not <strong>unmount</strong>.</p>
</blockquote>
<p>You will recall that we have
<a href="03-filesystem-file-management.html">discussed filesystems earlier</a>,
and that the term is a bit confusing since it refers to both
the directory hierarchy and also the formatting type (e.g., ext4).
In that prior section, I discussed how in Windows,
attaching a new drive,
whether it's a USB drive, a DVD drive,
an additional disk drive, or an external drive,
Windows gives the new drive a letter,
like <strong>A:</strong>, <strong>B:</strong>, <strong>D:</strong>, etc.
Unlike Windows, I mentioned that in Linux and Unix (e.g., macOS),
when we add an additional disk,
its filesystem gets added onto our existing one.
That is, it becomes part of the directory hierarchy
and under the <code>/</code> top level part of the hierarchy.
In practice, this means that we have to create the <strong>mountpoint</strong>
for our new disk, and
we do that with the <code>mkdir</code> command.
The Google Console documentation instructs us
to use the following command:</p>
<pre><code>sudo mkdir -p /mnt/disks/MOUNT_DIR
</code></pre>
<p>And to replace <strong>MOUNT_DIR</strong> with the directory we
want to create.
Since my added disk is named <strong>disk-1</strong>,
I'll call it that:</p>
<pre><code>sudo mkdir -p /mnt/disks/disk-1
</code></pre>
<p>Now we can <code>mount</code> the disk to that directory.
Per the instructions on Google Console,
and given that my added drive has the device name <strong>sdb</strong>,
I use the following command:</p>
<pre><code>sudo mount -o discard,defaults /dev/sdb /mnt/disks/disk-1
</code></pre>
<p>We also need to change the modifications, and
grant access for additional users:</p>
<pre><code>sudo chmod 777 /mnt/disks/disk-1
</code></pre>
<p>We can test that it exists and is accessible with
the <code>lsblk</code> and the <code>cd</code> commands.
The <code>lsblk</code> command should show that <strong>sdb</strong> is
mounted at <code>/mnt/disks/disk-1</code>, and
we can <code>cd</code> (change directory) to it:</p>
<pre><code>cd /mnt/disks/disk-1
</code></pre>
<h3 id="automounting-our-disk"><a class="header" href="#automounting-our-disk">Automounting Our Disk</a></h3>
<p>Our disk is mounted, but if the computer (VM) gets rebooted,
we would have to re-<code>mount</code> the additional drive manually.
In order to avoid this and automount the drive upon reboot,
we need to edit the file <code>/etc/fstab</code>.</p>
<blockquote>
<p>Note that the file is named <strong>fstab</strong> and
that it's located in the <strong>/etc</strong> directory.
Therefore the full path is <code>/etc/fstab</code></p>
</blockquote>
<p>The <strong>fstab</strong> file is basically a configuration file
that provides information to the OS about the filesystems
the system can mount.
The standard information <strong>fstab</strong> contains includes
the name (or label) of the device being mounted,
the mountpoint (e.g., <code>/mnt/disks/disk-1</code>),
the filesystem type (e.g., <strong>ext4</strong>),
and various other mount options.
See <code>man fstab</code> for more details.
For devices to mount upon boot up automatically,
they have to be listed in this file.
That means we need to edit this file on our VM.</p>
<p>Again, here we're following the Google Cloud instructions:</p>
<p>Before we edit system configuration files, however,
always create a backup.
We'll use the <code>cd</code> command to create a backup of the <strong>fstab</strong> file.</p>
<pre><code>sudo cp /etc/fstab /etc/fstab.backup
</code></pre>
<p>Next we use the <code>blkid</code> command to get
the UUID (universally unique identifier)
number for our new device.
Since my device is <code>/dev/sdb</code>,
I'll use that:</p>
<pre><code>sudo blkid /dev/sdb
</code></pre>
<p>The output should look something like this
<strong>BUT NOTE that your UUID value will
be DIFFERENT</strong>:</p>
<pre><code>/dev/sdb: UUID="3bc141e2-9e1d-428c-b923-0f9vi99a1123" TYPE="ext4"
</code></pre>
<p>We need to add that value to <code>/etc/fstab</code>
plus the standard information that file requires.
The Google Cloud documentation explicitly guides us here.
We'll use <code>nano</code> to make the edit:</p>
<pre><code>sudo nano /etc/fstab
</code></pre>
<p>And then add this line at the bottom:</p>
<pre><code>UUID=3bc141e2-9e1d-428c-b923-0f9vi99a1123 /mnt/disks/disk-1 ext4 discard,defaults,nofail 0 2
</code></pre>
<p>And that's it!
If you reboot your VM, or
if your VM rebooted for some reason,
the extra drive we added should automatically
mount upon reboot.
If it doesn't,
then it may mean that the drive failed,
or that there was an error (i.e., typo) in the configuration.</p>
<h3 id="delete-the-disk"><a class="header" href="#delete-the-disk">Delete the Disk</a></h3>
<p>You are welcome to keep the disk attached to the VM,
but if you do not want to incur any charges for it,
which would be about $1 / month at 10 GB,
then we can delete it.</p>
<p>To delete the disk,
first delete the line that we added in <code>/etc/fstab</code>,
unmount it,
and then delete the disk in the gcloud console.</p>
<p>To unmount the disk, we use the <code>umount</code> command:</p>
<pre><code>sudo umount /mnt/disks/disk-1
</code></pre>
<p>Then we need to delete the disk in gcloud.</p>
<ol>
<li>Go to the <strong>VM instances</strong> page.</li>
<li>Click on the check box next to the VM.</li>
<li>Click on the name, which should be a hyperlink.</li>
<li>This goes to the <strong>VM instances detail</strong> page.</li>
<li>Click on the <strong>Edit</strong> button at the top of the page.</li>
<li>Scroll down to the <strong>Additional disks</strong> section.</li>
<li>Click the edit (looks like a pencil) button.</li>
<li>In the right-hand pane that opens up, select <strong>Delete disk</strong> under the
<strong>Deletion rule</strong> section.</li>
<li>Scroll back to the <strong>Additional disks</strong> section.</li>
<li>Click on the <code>X</code> to detach the disk.</li>
<li>Click on <strong>Save</strong>.</li>
<li>Go the <strong>Disk</strong> section in the left-hand navigation pane.</li>
<li>Check the disk to delete, and then Delete it.</li>
<li>Click on the <strong>Snapshots</strong> section in the left-hand navigation pane.</li>
<li>Check the disk snapshot to delete, and then Delete it.
<ul>
<li>Be sure you don't delete your VM here but just your disk.</li>
</ul>
</li>
</ol>
<h2 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h2>
<p>In this section we learned how to expand
the storage of our VM by creating a new virtual drive,
adding it to our VM,
formatting the drive in the <strong>ext4</strong> filesystem format,
mounting the drive at <code>/mnt/disks/disk-1</code>, and
then editing <code>/etc/fstab</code> to make automount the drive.</p>
<p>In addition to using the gcloud console,
the commands we used in this section include:</p>
<ol>
<li><code>ssh</code>  : to connect to the remote VM</li>
<li><code>sudo</code> : to run commands as the administrator</li>
<li><code>mkfs.ext</code> : to create an <strong>ext4</strong> filesystem on our new drive</li>
<li><code>mkdir -p</code> : to create multiple directories under <code>/mnt</code></li>
<li><code>mount</code> : to mount manually the new drive</li>
<li><code>umount</code> : to unmount manually the new drive</li>
<li><code>chmod</code> : to change the mountpoint's file permission attributes</li>
<li><code>cd</code> : to change directories</li>
<li><code>cp</code> : to copy a file</li>
<li><code>nano</code> : to use the text editor <code>nano</code> to edit <code>/etc/fstab</code></li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="p5-managing-the-system.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="5b-managing-users-groups.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="p5-managing-the-system.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="5b-managing-users-groups.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
